<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>ImageMagick æ¼æ´å‡‘çƒ­é—¹æ‰‹æœ­ &ndash; # alert`D0n9` ï½œ è¾“æ”»å¢¨å®ˆ</title>
	<link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/nav.css">
    
    
    
    
    
	<link rel="stylesheet" href="/css/themes/light.css">
</head>
<body>
	<input class="show-hide-menu-input" style="display:none;" autocomplete="off" type="checkbox" id="toggle-1">
	<label class="overlay" for="toggle-1"></label>
	<div class="main">
		<header class="header">
			<div class="header-content">
				<div class="title">
					<a href="https://d0n9.github.io/"># alert`D0n9` ï½œ è¾“æ”»å¢¨å®ˆ</a>
				</div>
				<div>
					<div class="header-right">
						<label id="show-hide-menu-label" class="clickable-header-label" for="toggle-1">
							<img class="color-adapting-image" width="30" src="/images/hamburger.svg" alt="menu button">
						</label>
					</div>
					<div class="dont-show">
						<p>
							Links:
						</p>
					</div>
					<ul class="links">
						<li><a href="/">Home</a></li>
						<li><a href="/posts/">Posts</a></li>
						<li><a href="/about-me/">About Me</a></li>
						<li><a href="/tags/">Tags</a></li>
					</ul>
				</div>
			</div>
		</header>
		<main class="body">
			<div class="body-content">
  <header class="title-header">
    <h1>ImageMagick æ¼æ´å‡‘çƒ­é—¹æ‰‹æœ­</h1>
    <div class="title-header-date">
        <time>Wednesday, August 22, 2018</time>
    </div>
    
  </header>
  <p>ä»Šå¤©æ—¥å¸¸åˆ· twitter çœ‹åˆ° Tavis ç‚¹èµäº†è¿™æ¡æ¨</p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171659325.jpg" alt=""></p>
<p>ç»å†è¿‡2016å¹´é­”å›¾æ¼æ´æ´—ç¤¼çš„äººçœ‹åˆ° ImageMagick å°±å¾ˆæ•æ„Ÿï¼Œfu*k è¿™æ˜¯åˆæŠ¥æ¼æ´äº†ï¼ŒImageMagick è¿ç”¨å¾ˆå¹¿æ³›ï¼Œèµ¶ç´§åº”æ€¥ä¸€æ³¢ã€‚</p>
<p>ä¸è¿‡æ¯”è¾ƒå‘çš„æ˜¯å°±æ²¡æœ‰å…¶ä»–ä¿¡æ¯ï¼Œå—å½±å“çš„ä¸»æœºå—å½±å“ç‰ˆæœ¬å•¥éƒ½æ²¡æœ‰ï¼Œç”šè‡³ç»„ä»¶å®˜æ–¹ä¹Ÿæ²¡æœ‰å‘å¸ƒå®‰å…¨å…¬å‘Š</p>
<p>æŒ‰ç…§å»ºè®®çš„ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆhttps://www.kb.cert.org/vuls/id/332928 ï¼‰é’ˆå¯¹è£…æœ‰ImageMagickçš„æœºå™¨æ”¹ä¸€ä¸‹ <strong>/etc/ImageMagick/policy.xml</strong> é…ç½®æ–‡ä»¶ï¼Œç¦ç”¨ä»¥ä¸‹ç¼–ç å™¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;policy domain=&#34;coder&#34; rights=&#34;none&#34; pattern=&#34;PS&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;policy domain=&#34;coder&#34; rights=&#34;none&#34; pattern=&#34;EPS&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;policy domain=&#34;coder&#34; rights=&#34;none&#34; pattern=&#34;PDF&#34; /&gt;
</span></span><span class="line"><span class="cl">&lt;policy domain=&#34;coder&#34; rights=&#34;none&#34; pattern=&#34;XPS&#34; /&gt;
</span></span></code></pre></div><p>å…¶å®åœ¨2016å¹´çš„çˆ†ImageMagick RCEï¼ˆCVE-2016-3714ï¼‰çš„æ—¶å€™ï¼Œå½“æ—¶å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼ˆhttps://imagetragick.com/ ï¼‰p.s è™½ç„¶ä½¿ç”¨é»‘åå•çš„æ–¹å¼ä¸å¤ªç¬¦åˆæ¼æ´ä¿®å¤åŸåˆ™..</p>
<p>æ›´æ”¹å®Œé…ç½®æ–‡ä»¶åè¦æ€æ ·éªŒè¯æ˜¯å¦ä¿®å¤äº†å‘¢ï¼Ÿ</p>
<p>ä¸¤ç§æ–¹æ³•</p>
<p>1ã€ æ‰¾åˆ°å„ä¸ªç½‘ç«™çš„ä¸Šä¼ æ¥å£ï¼ŒæŠŠ poc å›¾ç‰‡æ‰“ä¸€é.. åæ­£æ˜¯æ‰§è¡Œå‘½ä»¤å˜›ï¼Œç”¨ dnslog æˆ–è€…åå¼¹ SHELL çš„ æ–¹å¼éƒ½å¯ä»¥
2ã€ åœ¨ä¸»æœºä¸Šæ‰§è¡Œ convert poc.jpeg poc.gif</p>
<p>ä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸æ˜¯æœ€ä¼˜</p>
<p>å› ä¸ºçŸ­æ—¶é—´ä¸å¯èƒ½æ‰¾å…¨æ‰€æœ‰çš„ä¸Šä¼ æ¥å£ï¼Œè€Œä¸”æ‰“ poc çš„æ–¹å¼å­˜åœ¨ä¸€å®šçš„ä¸ç¨³å®šæ€§ï¼Œåœ¨ä¸ç¡®å®šæ˜¯å¦ä¼šå¯¹ä¸»æœºé€ æˆå½±å“çš„æƒ…å†µä¸‹å°½é‡ä¸è¦å°è¯•ï¼Œå½“ç„¶å¦‚æœæ˜¯æµ‹è¯•ç¯å¢ƒçš„è¯é‚£å°±éšä¾¿é€ äº†ã€‚</p>
<p>æ‰§è¡Œconvert æ–¹å¼æœ€ç®€å•çš„ï¼Œæ’æŸ¥èµ·æ¥ä¹Ÿä¼šæ›´å¿«é€Ÿæ›´å‡†ç¡®ï¼Œå¯¹ä¸»æœºå½±å“ä¹Ÿæœ€å°æœ€å¯æ§ï¼Œä¸è¿‡å‘¢ï¼Œæœ‰äº›ä¸»æœºå®‰è£…çš„ ImageMagick-libs å¯èƒ½ä¸ä¼šæœ‰ convert å‘½ä»¤ ï¼ˆä¸ç¡®å®šï¼‰</p>
<p>ç„¶ååœ¨æˆ‘ä¹ æƒ¯æ€§ less poc.jpeg ï¼ˆless å‘½ä»¤å¾ˆå¥½ç”¨ï¼‰å‘ç°ç«Ÿç„¶ä¹Ÿæ‰§è¡Œäº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171659909.jpg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171659673.jpg" alt=""></p>
<p>è¿™å°±å¾ˆæœ‰æ„æ€äº†ã€‚</p>
<p>è™½ç„¶çŸ¥é“è¿™ä¸ªæ¼æ´æ˜¯å› ä¸º Ghostscript æ²™ç›’é€ƒé€¸ï¼ˆhttps://cert.360.cn/warning/detail?id=154bd8345f9cd560ea1c0e5bf453a41d ï¼‰ImageMagick åªæ˜¯ä¼—å¤šå—å½±å“çš„è½¯ä»¶ä¹‹ä¸€ï¼Œä½†æ˜¯ less ä¹Ÿå—å½±å“å°±æœ‰äº›åŒªå¤·æ‰€æ€äº†..</p>
<p>æœ¬ç€çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶çš„æ€åº¦ï¼Œæˆ‘å†³å®šæ‰¾æ‰¾åŸå› ï¼Œå½“ç„¶ c æˆ‘æ˜¯å®¡è®¡ä¸æ¥çš„ï¼Œé€†å‘æˆ‘ä¹Ÿæ˜¯ä¸æ‡‚çš„ ğŸ˜­</p>
<p>ä½†æ˜¯è¿˜å¯ä»¥ç”¨ strace è·Ÿè¸ªè¿›ç¨‹ä¸­çš„ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼ä¸€çª¥ç©¶ç«Ÿ</p>
<p>æ³¨æ„ï¼Œå› ä¸ºæ˜¯ç”¨çš„ docker çš„ centos ç¯å¢ƒï¼Œæ‰€ä»¥å¯åŠ¨æ—¶è¦åŠ ä¸Š <strong>&ndash;security-opt seccomp:unconfined</strong></p>
<p>ç„¶åå°±å¯ä»¥ä½¿ç”¨ strace è¿›è¡Œè°ƒè¯•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">strace -f -o /tmp/less-devul.txt less poc.jpeg
</span></span></code></pre></div><p>è°ƒè¯•æ—¥å¿—æ˜¯è¿™æ ·çš„ï¼Œè·Ÿè¸ªåˆ°çš„è¿›ç¨‹ä¸­çš„ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒ…æ‹¬ fork è°ƒç”¨æ‰€äº§ç”Ÿçš„å­è¿›ç¨‹</p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171659680.jpg" alt=""></p>
<p>execve å°±æ˜¯æ‰§è¡Œçš„å…·ä½“å‘½ä»¤ï¼Œç„¶åæˆ‘æ³¨æ„åˆ°è¿™ä¸€æ¡</p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171700815.jpg" alt=""></p>
<p>åŸºæœ¬å°±ç¡®å®šå°±æ˜¯è¿™ä¸ªåŸå› </p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171700610.jpg" alt=""></p>
<p>è¿™æ˜¯ä¸ªä»€ä¹ˆé¬¼è„šæœ¬ï¼Œçœ‹ä¸€ä¸‹ less /usr/bin/lesspipe.sh</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># To use this filter with less, define LESSOPEN:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># export LESSOPEN=&#34;|/usr/bin/lesspipe.sh %s&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># The script should return zero if the output was valid and non-zero</span>
</span></span><span class="line"><span class="cl"><span class="c1"># otherwise, so less could detect even a valid empty output</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (for example while uncompressing gzipped empty file).</span>
</span></span><span class="line"><span class="cl"><span class="c1"># For backward-compatibility, this is not required by default. To turn</span>
</span></span><span class="line"><span class="cl"><span class="c1"># this functionality there should be another vertical bar (|) straight</span>
</span></span><span class="line"><span class="cl"><span class="c1"># after the first one in the LESSOPEN environment variable:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># export LESSOPEN=&#34;||/usr/bin/lesspipe.sh %s&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># This function makes all return values 1 when 0 and otherwise 0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Usually, app returns 0 when succeded and we need to return 1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># This behavior is forced because backward compatiblity</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (tcsh print_exit_value bug)</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> handle_exit_status<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="nv">$1</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">exit</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -e <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        handle_exit_status <span class="m">1</span> <span class="nv">$1</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        ls -alF -- <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        handle_exit_status <span class="nv">$?</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">exec</span> 2&gt;/dev/null
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> in
</span></span><span class="line"><span class="cl">*.<span class="o">[</span>1-9n<span class="o">]</span>.bz2<span class="p">|</span>*.<span class="o">[</span>1-9<span class="o">]</span>x.bz2<span class="p">|</span>*.man.bz2<span class="p">|</span>*.<span class="o">[</span>1-9n<span class="o">]</span>.<span class="o">[</span>gx<span class="o">]</span>z<span class="p">|</span>*.<span class="o">[</span>1-9<span class="o">]</span>x.<span class="o">[</span>gx<span class="o">]</span>z<span class="p">|</span>*.man.<span class="o">[</span>gx<span class="o">]</span>z<span class="p">|</span>*.<span class="o">[</span>1-9n<span class="o">]</span>.lzma<span class="p">|</span>*.<span class="o">[</span>1-9<span class="o">]</span>x.lzma<span class="p">|</span>*.man.lzma<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> in
</span></span><span class="line"><span class="cl">        *.gz<span class="o">)</span>           <span class="nv">DECOMPRESSOR</span><span class="o">=</span><span class="s2">&#34;gzip -dc&#34;</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        *.bz2<span class="o">)</span>          <span class="nv">DECOMPRESSOR</span><span class="o">=</span><span class="s2">&#34;bzip2 -dc&#34;</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        *.xz<span class="p">|</span>*.lzma<span class="o">)</span>    <span class="nv">DECOMPRESSOR</span><span class="o">=</span><span class="s2">&#34;xz -dc&#34;</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        <span class="k">esac</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$DECOMPRESSOR</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nv">$DECOMPRESSOR</span> -- <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="p">|</span> file - <span class="p">|</span> grep -q troff<span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$DECOMPRESSOR</span> -- <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="p">|</span> groff -Tascii -mandoc -
</span></span><span class="line"><span class="cl">                handle_exit_status <span class="nv">$?</span>
</span></span><span class="line"><span class="cl">        <span class="k">fi</span> <span class="p">;;&amp;</span>
</span></span><span class="line"><span class="cl">*.<span class="o">[</span>1-9n<span class="o">]</span><span class="p">|</span>*.<span class="o">[</span>1-9<span class="o">]</span>x<span class="p">|</span>*.man<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> file <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="p">|</span> grep -q troff<span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">                groff -Tascii -mandoc <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="p">|</span> cat -s
</span></span><span class="line"><span class="cl">                handle_exit_status <span class="nv">$?</span>
</span></span><span class="line"><span class="cl">        <span class="k">fi</span> <span class="p">;;&amp;</span>
</span></span><span class="line"><span class="cl">*.tar<span class="o">)</span> tar tvvf <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="p">;</span> handle_exit_status <span class="nv">$?</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*.tgz<span class="p">|</span>*.tar.gz<span class="p">|</span>*.tar.<span class="o">[</span>zZ<span class="o">])</span> tar tzvvf <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="p">;</span> handle_exit_status <span class="nv">$?</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*.tar.xz<span class="o">)</span> tar Jtvvf <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="p">;</span> handle_exit_status <span class="nv">$?</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*.xz<span class="p">|</span>*.lzma<span class="o">)</span> xz -dc -- <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="p">;</span> handle_exit_status <span class="nv">$?</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*.tar.bz2<span class="p">|</span>*.tbz2<span class="o">)</span> bzip2 -dc -- <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="p">|</span> tar tvvf -<span class="p">;</span> handle_exit_status <span class="nv">$?</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*.<span class="o">[</span>zZ<span class="o">]</span><span class="p">|</span>*.gz<span class="o">)</span> gzip -dc -- <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="p">;</span> handle_exit_status <span class="nv">$?</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*.bz2<span class="o">)</span> bzip2 -dc -- <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="p">;</span> handle_exit_status <span class="nv">$?</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*.zip<span class="p">|</span>*.jar<span class="p">|</span>*.nbm<span class="o">)</span> zipinfo -- <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="p">;</span> handle_exit_status <span class="nv">$?</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*.rpm<span class="o">)</span> rpm -qpivl --changelog -- <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="p">;</span> handle_exit_status <span class="nv">$?</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*.cpi<span class="p">|</span>*.cpio<span class="o">)</span> cpio -itv &lt; <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="p">;</span> handle_exit_status <span class="nv">$?</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*.gif<span class="p">|</span>*.jpeg<span class="p">|</span>*.jpg<span class="p">|</span>*.pcd<span class="p">|</span>*.png<span class="p">|</span>*.tga<span class="p">|</span>*.tiff<span class="p">|</span>*.tif<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">[</span> -x /usr/bin/identify <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">                identify <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                handle_exit_status <span class="nv">$?</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="o">[</span> -x /usr/bin/gm <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">                gm identify <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                handle_exit_status <span class="nv">$?</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span> <span class="s2">&#34;No identify available&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span> <span class="s2">&#34;Install ImageMagick or GraphicsMagick to browse images&#34;</span>
</span></span><span class="line"><span class="cl">                handle_exit_status <span class="m">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">fi</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">*<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">[</span> -x /usr/bin/file -a -x /usr/bin/iconv -a -x /usr/bin/cut <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">                <span class="k">case</span> <span class="sb">`</span>file -b <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span><span class="sb">`</span> in
</span></span><span class="line"><span class="cl">                *UTF-16*<span class="o">)</span> <span class="nv">conv</span><span class="o">=</span><span class="s1">&#39;UTF-16&#39;</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">                *UTF-32*<span class="o">)</span> <span class="nv">conv</span><span class="o">=</span><span class="s1">&#39;UTF-32&#39;</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">                <span class="k">esac</span>
</span></span><span class="line"><span class="cl">                <span class="nv">env</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$LANG</span> <span class="p">|</span> cut -d. -f2<span class="sb">`</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">[</span> -n  <span class="s2">&#34;</span><span class="nv">$conv</span><span class="s2">&#34;</span> -a -n <span class="s2">&#34;</span><span class="nv">$env</span><span class="s2">&#34;</span> -a <span class="s2">&#34;</span><span class="nv">$conv</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$env</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">                        iconv -f <span class="nv">$conv</span> -t <span class="nv">$env</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                        handle_exit_status <span class="nv">$?</span>
</span></span><span class="line"><span class="cl">                <span class="k">fi</span>
</span></span><span class="line"><span class="cl">        <span class="k">fi</span>
</span></span><span class="line"><span class="cl">        handle_exit_status <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="k">esac</span>
</span></span></code></pre></div><p>Sogaï¼Œè°ƒç”¨äº† ImageMagick çš„ identify å‘½ä»¤ï¼Œless å›¾ç‰‡æ ¼å¼æ–‡ä»¶çš„è¯ï¼Œä¼šè¾“å‡ºè¿™å¼ å›¾çš„å„é¡¹ä¿¡æ¯ï¼Œä¹Ÿæ˜¯ç”¨åˆ°çš„ ImageMagick æˆ–è€… GraphicsMagick è¿™ä¸¤ä¸ªåº“</p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171700683.jpg" alt=""></p>
<p>ç»§ç»­è·Ÿè¿›ä¹Ÿçš„ç¡®è¯å®äº†è¿™ä¸€ç‚¹</p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171701794.jpg" alt=""></p>
<p>è€Œä¸”æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿæœ‰å»è¯» policy.xmlï¼Œä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åæ˜¯ç«‹å³ç”Ÿæ•ˆçš„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171701532.jpg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171702811.jpg" alt=""></p>
<p>æ‰€ä»¥è¯´åŸºç¡€ç»„ä»¶å‡ºé—®é¢˜å½±å“çš„èŒƒå›´æ˜¯ååˆ†å¹¿æ³›çš„ã€‚é»˜è®¤æºæœä¸€ä¸‹å°±æœ‰è¿™ä¹ˆå¤š</p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171702419.jpg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171702978.jpg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/D0n9/static-repo/main/images/2018/08/202402171702967.jpg" alt=""></p>

  
  
  <div class="post-tags">
    <p>Tags: 
    
      <a href="/tags/%E9%9A%8F%E7%AC%94">éšç¬”</a>
    
      <a href="/tags/web%E5%AE%89%E5%85%A8">Webå®‰å…¨</a>
    
      <a href="/tags/imagemagick">ImageMagick</a>
    
      <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90">æ¼æ´åˆ†æ</a>
    
    </p>
  </div>
  

			</div>
		</main>
	</div>
	<hr class="dont-show">
	<footer class="footer">
		<p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/stevenengler/no-js-hugo-theme">no-js-hugo-theme</a></p>
	</footer>
</body>
</html>
